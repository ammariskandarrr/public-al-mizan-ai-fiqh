# Shariah Document Analyzer - Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER UPLOADS DOCUMENT                                â”‚
â”‚                         (PDF / DOCX / Image)                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TEXT EXTRACTION (Gemini 2.5 Flash)                        â”‚
â”‚                    "Extract all text content..."                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 EMBEDDING GENERATION (OpenAI)                                â”‚
â”‚                 text-embedding-3-large (1536 dimensions)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     PARALLEL AGENT EXECUTION                                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   AGENT A        â”‚  â”‚   AGENT B        â”‚  â”‚   AGENT C        â”‚         â”‚
â”‚  â”‚ BNM Resolutions  â”‚  â”‚   IFSA 2013      â”‚  â”‚ Contract Frame   â”‚         â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚         â”‚
â”‚  â”‚ Model:           â”‚  â”‚ Model:           â”‚  â”‚ Model:           â”‚         â”‚
â”‚  â”‚ GPT-4o-mini      â”‚  â”‚ GPT-4o-mini      â”‚  â”‚ GPT-4o-mini      â”‚         â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚         â”‚
â”‚  â”‚ RAG Sources:     â”‚  â”‚ RAG Sources:     â”‚  â”‚ RAG Sources:     â”‚         â”‚
â”‚  â”‚ â€¢ bnm_resolutionsâ”‚  â”‚ â€¢ islamic_fin... â”‚  â”‚ â€¢ shariah_con... â”‚         â”‚
â”‚  â”‚ â€¢ shariah_con... â”‚  â”‚ â€¢ shariah_con... â”‚  â”‚ â€¢ bnm_resolutionsâ”‚         â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                  â”‚         â”‚
â”‚  â”‚ Output:          â”‚  â”‚ Output:          â”‚  â”‚ Output:          â”‚         â”‚
â”‚  â”‚ â€¢ Findings       â”‚  â”‚ â€¢ Findings       â”‚  â”‚ â€¢ Findings       â”‚         â”‚
â”‚  â”‚ â€¢ Status         â”‚  â”‚ â€¢ Status         â”‚  â”‚ â€¢ Status         â”‚         â”‚
â”‚  â”‚ â€¢ Summary        â”‚  â”‚ â€¢ Summary        â”‚  â”‚ â€¢ Summary        â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                       â”‚
â”‚  â”‚   AGENT D        â”‚                                                       â”‚
â”‚  â”‚  Mufti Fatwas    â”‚                                                       â”‚
â”‚  â”‚                  â”‚                                                       â”‚
â”‚  â”‚ Model:           â”‚                                                       â”‚
â”‚  â”‚ GPT-4o-mini      â”‚                                                       â”‚
â”‚  â”‚                  â”‚                                                       â”‚
â”‚  â”‚ RAG Sources:     â”‚                                                       â”‚
â”‚  â”‚ â€¢ mufti_qa       â”‚                                                       â”‚
â”‚  â”‚ â€¢ bnm_resolutionsâ”‚                                                       â”‚
â”‚  â”‚                  â”‚                                                       â”‚
â”‚  â”‚ Output:          â”‚                                                       â”‚
â”‚  â”‚ â€¢ Findings       â”‚                                                       â”‚
â”‚  â”‚ â€¢ Status         â”‚                                                       â”‚
â”‚  â”‚ â€¢ Summary        â”‚                                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  FINAL SYNTHESIS AGENT (Gemini 2.5 Pro)                      â”‚
â”‚                                                                              â”‚
â”‚  Tasks:                                                                      â”‚
â”‚  1. Consolidate findings from all 4 agents                                  â”‚
â”‚  2. Deduplicate similar issues                                              â”‚
â”‚  3. Prioritize: Regulatory (IFSA/BNM) > Interpretive (Mufti)               â”‚
â”‚  4. Generate executive summary                                              â”‚
â”‚  5. Create structured report                                                â”‚
â”‚  6. Map findings to document text for highlighting                          â”‚
â”‚                                                                              â”‚
â”‚  Context Window: ~2M tokens (can hold entire document + all agent reports)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STRUCTURED AUDIT REPORT                               â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 1. COMPLIANCE STATUS                                             â”‚       â”‚
â”‚  â”‚    â€¢ Status: Compliant / Compliant with Conditions / Non-Compliantâ”‚      â”‚
â”‚  â”‚    â€¢ Score: 0-100                                                â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 2. EXECUTIVE SUMMARY                                             â”‚       â”‚
â”‚  â”‚    High-level overview of findings and critical flags            â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 3. PROBLEMATIC CLAUSES                                           â”‚       â”‚
â”‚  â”‚    For each issue:                                               â”‚       â”‚
â”‚  â”‚    â€¢ Exact Text: "..."                                           â”‚       â”‚
â”‚  â”‚    â€¢ Issue Description: Why it's problematic                     â”‚       â”‚
â”‚  â”‚    â€¢ Authority Reference: "BNM SAC Resolution 12.3: ..."         â”‚       â”‚
â”‚  â”‚    â€¢ Severity: High / Medium / Low                               â”‚       â”‚
â”‚  â”‚    â€¢ Detected By: [Agent A, Agent B]                             â”‚       â”‚
â”‚  â”‚    â€¢ Recommendation: How to fix it                               â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 4. COMPLIANT ASPECTS                                             â”‚       â”‚
â”‚  â”‚    Positive findings and Shariah-compliant elements              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 5. RECOMMENDATIONS                                               â”‚       â”‚
â”‚  â”‚    Actionable steps to achieve compliance                        â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ 6. INDIVIDUAL AGENT ANALYSES                                     â”‚       â”‚
â”‚  â”‚    Detailed findings from each of the 4 specialist agents        â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            USER INTERFACE                                    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  DOCUMENT PREVIEW      â”‚  â”‚  ANALYSIS RESULTS                  â”‚        â”‚
â”‚  â”‚                        â”‚  â”‚                                    â”‚        â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  â”‚ Compliance Status: âœ…         â”‚ â”‚        â”‚
â”‚  â”‚  â”‚   PDF Viewer     â”‚  â”‚  â”‚  â”‚ Score: 85/100                â”‚ â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚                                    â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  Executive Summary:                â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  "This Murabaha agreement..."      â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚                                    â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  Problematic Clauses (2):          â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  â”‚ ğŸ”´ High Severity           â”‚   â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  â”‚ "Late payment fee..."      â”‚   â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  â”‚ Authority: IFSA Section 28 â”‚   â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  â”‚ Detected by: IFSA, BNM     â”‚   â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  â”‚ [Click to highlight]       â”‚   â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚                                    â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  Compliant Aspects (5):            â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  âœ… Asset ownership transfer...    â”‚        â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚  â”‚  âœ… Profit-sharing mechanism...    â”‚        â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚                                    â”‚        â”‚
â”‚  â”‚                        â”‚  â”‚  [Export Report] [Download PDF]    â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Timeline

```
Time: 0s
â”œâ”€ User uploads document
â”‚
Time: 0-10s
â”œâ”€ Text extraction (Gemini 2.5 Flash)
â”‚  â””â”€ Extract all text, preserve structure
â”‚
Time: 10-15s
â”œâ”€ Embedding generation (OpenAI)
â”‚  â””â”€ Create semantic vector for RAG queries
â”‚
Time: 15-45s (Parallel)
â”œâ”€ Agent A: BNM Resolutions
â”‚  â”œâ”€ Query bnm_resolutions VDB
â”‚  â”œâ”€ Query shariah_contract_framework VDB
â”‚  â”œâ”€ Analyze with GPT-4o-mini
â”‚  â””â”€ Return findings
â”‚
â”œâ”€ Agent B: IFSA 2013
â”‚  â”œâ”€ Query islamic_financial_act VDB
â”‚  â”œâ”€ Query shariah_contract_framework VDB
â”‚  â”œâ”€ Analyze with GPT-4o-mini
â”‚  â””â”€ Return findings
â”‚
â”œâ”€ Agent C: Contract Framework
â”‚  â”œâ”€ Query shariah_contract_framework VDB
â”‚  â”œâ”€ Query bnm_resolutions VDB
â”‚  â”œâ”€ Analyze with GPT-4o-mini
â”‚  â””â”€ Return findings
â”‚
â””â”€ Agent D: Mufti Fatwas
   â”œâ”€ Query mufti_qa VDB
   â”œâ”€ Query bnm_resolutions VDB
   â”œâ”€ Analyze with GPT-4o-mini
   â””â”€ Return findings
â”‚
Time: 45-60s
â”œâ”€ Final Synthesis (Gemini 2.5 Pro)
â”‚  â”œâ”€ Consolidate all findings
â”‚  â”œâ”€ Deduplicate similar issues
â”‚  â”œâ”€ Prioritize regulatory findings
â”‚  â”œâ”€ Generate executive summary
â”‚  â””â”€ Create structured report
â”‚
Time: 60s
â””â”€ Display results to user
   â””â”€ Interactive UI with highlighting
```

## Vector Database Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SUPABASE VECTOR DATABASES                     â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ bnm_resolutions    â”‚  â”‚ islamic_financial  â”‚                â”‚
â”‚  â”‚ (VDB-01)           â”‚  â”‚ _act (VDB-02)      â”‚                â”‚
â”‚  â”‚                    â”‚  â”‚                    â”‚                â”‚
â”‚  â”‚ â€¢ Resolutions      â”‚  â”‚ â€¢ IFSA sections    â”‚                â”‚
â”‚  â”‚ â€¢ Rulings          â”‚  â”‚ â€¢ Regulations      â”‚                â”‚
â”‚  â”‚ â€¢ Guidelines       â”‚  â”‚ â€¢ Requirements     â”‚                â”‚
â”‚  â”‚                    â”‚  â”‚                    â”‚                â”‚
â”‚  â”‚ Embeddings: 1536   â”‚  â”‚ Embeddings: 1536   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ shariah_contract   â”‚  â”‚ mufti_qa           â”‚                â”‚
â”‚  â”‚ _framework (VDB-03)â”‚  â”‚ (VDB-04)           â”‚                â”‚
â”‚  â”‚                    â”‚  â”‚                    â”‚                â”‚
â”‚  â”‚ â€¢ Contract types   â”‚  â”‚ â€¢ Fatwas           â”‚                â”‚
â”‚  â”‚ â€¢ Structures       â”‚  â”‚ â€¢ Q&A              â”‚                â”‚
â”‚  â”‚ â€¢ Guidelines       â”‚  â”‚ â€¢ Interpretations  â”‚                â”‚
â”‚  â”‚                    â”‚  â”‚                    â”‚                â”‚
â”‚  â”‚ Embeddings: 1536   â”‚  â”‚ Embeddings: 1536   â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                  â”‚
â”‚  RPC Functions:                                                 â”‚
â”‚  â€¢ match_bnm_resolutions(query_embedding, match_count)         â”‚
â”‚  â€¢ match_islamic_financial_act(query_embedding, match_count)   â”‚
â”‚  â€¢ match_shariah_contract_framework(query_embedding, ...)      â”‚
â”‚  â€¢ match_mufti_qa(query_embedding, match_count)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Agent Specialization Matrix

| Agent | Primary Focus | Secondary Focus | Vector DBs | Expertise Level |
|-------|--------------|----------------|------------|-----------------|
| **BNM Resolutions** | BNM SAC Rulings | Contract Framework | 2 | Regulatory |
| **IFSA 2013** | Malaysian Law | Contract Framework | 2 | Legal |
| **Contract Framework** | Contract Structure | BNM Guidelines | 2 | Technical |
| **Mufti Fatwas** | Fiqh Principles | BNM Context | 2 | Scholarly |

## Priority Hierarchy in Final Synthesis

```
1. CRITICAL (Invalidates Contract)
   â”œâ”€ IFSA violations
   â”œâ”€ BNM SAC violations
   â””â”€ Fundamental Shariah violations (Riba, Gharar)

2. HIGH (Non-standard, needs revision)
   â”œâ”€ Contract framework deviations
   â”œâ”€ Governance issues
   â””â”€ Risk allocation problems

3. MEDIUM (Advisory)
   â”œâ”€ Best practice recommendations
   â”œâ”€ Mufti interpretations
   â””â”€ Optimization suggestions

4. LOW (Informational)
   â”œâ”€ General observations
   â””â”€ Educational notes
```

---

This architecture ensures comprehensive, authoritative Shariah compliance analysis through multi-perspective expert review.
